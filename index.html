<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->

    	<link href="css/bootstrap.rtl.min.css" rel="stylesheet" >
	<link href="css/custom.css" rel="stylesheet">
    <title>Data Management Plan Template</title>
     <script src="wodotexteditor/wodotexteditor.js" type="text/javascript" charset="utf-8"></script>
    <script src="FileSaver.js" type="text/javascript" charset="utf-8"></script>
    <script src="localfileeditor.js" type="text/javascript" charset="utf-8"></script>
  </head>
  <script>
var odf = createEditor();
var undo_doc;
var refresh_doc;
const prefix = '$_';

function save_backup(before_name, callback) {
    let re = new RegExp("\\" + before_name, 'gi');

    if (callback(re)) {
        //console.log(callback(re));
        let odt_doc = document.getElementById("webodfeditor-canvascontainer1");
        undo_doc = odt_doc.cloneNode(true);

    }
}

function save_undo() {
    let odt_doc = document.getElementById("webodfeditor-canvascontainer1");
    refresh_doc = odt_doc.cloneNode(true);
    //odt_doc.parentNode.replaceChild(refresh_doc, odt_doc);
    if (refresh_doc == undo_doc || undo_doc == null) {
        undo_doc = odt_doc.cloneNode(true);
    }
}

function if_exist(re) {
    const match = document.getElementById("webodfeditor-canvascontainer1").innerHTML.match(re);
    let have_found = false;
    console.log(match);
    try {

        have_found = match.length > 1;

    } catch (e) {

        have_found = false;
    }
    return have_found;
}

function replace(child) {

    const before = child.previousElementSibling.name;
    save_backup(before, if_exist);
    const after = child.previousElementSibling.value;
    console.log(before, after);
    find_replace(before, after);
}

function undo() {

    const odt_doc = document.getElementById("webodfeditor-canvascontainer1");
    odt_doc.parentNode.replaceChild(undo_doc, odt_doc);
}



/**
 * edit checked/unchecked placeholders in the file.
 * @param {string} extended_match - the extended keyword (includes #if and #endif) need to be replaced.
 * 
 */

function check_box(element) {

    save_undo();

    const class_name = element.classList;
    console.log(class_name[0]);
    const checked = document.querySelectorAll(`.${class_name[0]}:checked`);
    //const checked = document.querySelectorAll('.nd-q:checked');
    //console.log([...checked]);
    const unchecked = document.querySelectorAll(`.${class_name[0]}:not(:checked)`);
    //console.log([...unchecked]);
    for (let i = 0; i < checked.length; i++) {
        let check_box_item = checked[i].id;
        //console.log(check_box );
        let name = check_box_item.split('_')[1];
        let match_name = prefix.concat(name.toUpperCase());
        console.log("check for loop, starts " + match_name + " " + checked.length);
        const selection = window.getSelection();

        selection.removeAllRanges();
        if (window.find) //for chrome, firefox
        {
            selection.removeAllRanges();
            //var ns = window.find(match_name, aWrapAround = 1);
            let ns = window.find(match_name, aWrapAround = 1);
            while (ns) {

                console.log("found");
                let match_range = window.getSelection().getRangeAt(0).cloneRange();
                let extended_match = window.getSelection().getRangeAt(0).cloneRange();
                if (window.getSelection().anchorOffset < 3) {
                    const old_offset = window.getSelection().anchorOffset;
                    console.log("no enough range "+ window.getSelection().anchorNode.toString());
                    extended_match.setStart(window.getSelection().anchorNode.previousSibling, window.getSelection().anchorNode.previousSibling.length - 3 + old_offset);
                } else {
                    console.log("enough range " + window.getSelection().anchorNode.toString());
                    extended_match.setStart(window.getSelection().anchorNode, window.getSelection().anchorOffset - 3);
                }
				
				if (window.getSelection().focusOffset < window.getSelection().focusNode.length) {
					var extended_end_node = window.getSelection().focusNode;
                    var extended_end_focus = window.getSelection().focusOffset +1;
                    console.log("end extended through focus " );
                    
                } else {
					var extended_end_node = window.getSelection().focusNode.nextSibling;
                    var extended_end_focus = 1;
                    console.log("end extended through node "  );
                    
                }
				
                const range_text = extended_match.toString();
                const previous_cha = range_text.slice(2, 3);
                console.log("previous_cha: " + previous_cha);

                window.find(" ");
				match_range.setEnd(extended_end_node, extended_end_focus);
				const range_text_2 = match_range.toString();
				const end_cha = range_text_2.slice(-1);
				if (end_cha == "|")
				{
				extended_match.setEnd(extended_end_node, extended_end_focus);
				}else {}
				console.log("selection is: " + extended_match);
                console.log("extended full length: " + match_range)



                if (previous_cha == "|" || previous_cha == "_") {
                    window.find("#if", aBackwards = 1);
                    extended_match.setStart(window.getSelection().anchorNode, window.getSelection().anchorOffset);
                    console.log(" selection updated because \| : " + extended_match);

                    match_mod(extended_match);
                    match_range.detach();
                } else if (previous_cha == "f") {

                    console.log("_____normal");
                    console.log(" range unchanged");
                    match_mod(extended_match);
                    match_range.detach();

                } else if (previous_cha == "," || previous_cha == " ") {
                    console.log("!!!! replace match text");

                    match_range.deleteContents();
                    match_range.insertNode(document.createTextNode(name));
                    match_range.detach();
                } else {

                    console.log("_____normal");
                    console.log("last character is: ", previous_cha);
                    match_mod(extended_match);
                    match_range.detach();
                }

                //window.find("#endif");

                match_range.detach();
                ns = window.find(match_name, aWrapAround = 1);
            }
        } else if (document.body.createTextRange) //for ie etc.
        {
            let range_if = document.body.createTextRange();
            while (range_if.findText(match_name)) {
                range_if.pasteHTML('haha______worked___');
            }
        }

        console.log("check for loop, ends " + match_name);
    }

    for (let i = 0; i < unchecked.length; i++) {
        let check_box_item = unchecked[i].id;
        //console.log(check_box );
        let name = check_box_item.split('_')[1];
        let match_name = prefix.concat(name.toUpperCase());
        console.log("uncheck for loop, starts " + match_name);
        const selection = window.getSelection();

        selection.removeAllRanges();
        if (window.find) //for chrome, firefox
        {

            let ns = window.find(match_name, aWrapAround = 1);

            while (ns) {

                console.log("found");
                let match_range = window.getSelection().getRangeAt(0).cloneRange();
                let extended_match = window.getSelection().getRangeAt(0);
                if (window.getSelection().anchorOffset < 3) {
                    const old_offset = window.getSelection().anchorOffset;
                    console.log("no enough range, old offset is " +  old_offset);

                    extended_match.setStart(window.getSelection().anchorNode.previousSibling, window.getSelection().anchorNode.previousSibling.length - 3 + old_offset);
                } else {
                    console.log("enough range, offset is " + window.getSelection().anchorOffset);
                    extended_match.setStart(window.getSelection().anchorNode, window.getSelection().anchorOffset - 3);
                }

                console.log("selection is: " + extended_match)

                window.find(" ");
                match_range.setEnd(window.getSelection().anchorNode, window.getSelection().anchorOffset);

                console.log("extended full length: " + extended_match)

                const range_text = extended_match.toString();
                const previous_cha = range_text.slice(2, 3)
                    console.log("previous_cha: " + previous_cha);

                if (previous_cha == "|" || previous_cha == "_") {
                    window.find("#if", aBackwards = 1);
                    match_range.setStart(window.getSelection().anchorNode, window.getSelection().anchorOffset);
                    console.log(" selection updated because \| : " + extended_match);

                    match_remove(extended_match);
                    match_range.detach();
                } else if (previous_cha == "f") {
                    console.log("_____normal");
                    console.log(" range unchanged");
                    match_remove(extended_match);
                    match_range.detach();
                } else if (previous_cha == "," || previous_cha == " ") {
                    console.log("!!!! removed match text");

                    match_range.deleteContents();
                    match_range.detach();

                } else {

                    console.log("_____normal");
                    console.log("last character is: ", previous_cha);
                    match_remove(extended_match);
                    match_range.detach();
                }

                //window.find("#endif");


                ns = window.find(match_name, aWrapAround = 1);
            }
        } else if (document.body.createTextRange) //for ie etc.
        {
            let range_if = document.body.createTextRange();
            while (range_if.findText(match_name)) {
                range_if.pasteHTML('');
            }
        }

        console.log("uncheck for loop, ends " + match_name);
    }
}

/**
 * match a place holder and then modify it.
 * @param {string} extended_match - the extended keyword (includes #if and #endif) need to be replaced.
 * 
 */

function match_mod(extended_match) {
    const text_after_if = (extended_match.toString().slice(3));
    console.log("after_endif: " + text_after_if);
    extended_match.deleteContents();

    window.find("#endif" + text_after_if);

    let end_if_range = window.getSelection().getRangeAt(0);
    end_if_range.deleteContents();
    end_if_range.detach();

}
/**
 * match a place holder and then remove it.
 * @param {string} extended_match - the extended keyword (includes #if and #endif) need to be removed.
 * 
 */
function match_remove(extended_match) {
    const text_after_if = (extended_match.toString().slice(3));
    console.log("after_if: " + text_after_if);

    window.find("#endif" + text_after_if);

    extended_match.setEnd(window.getSelection().focusNode, window.getSelection().focusOffset);
    extended_match.deleteContents();
    extended_match.detach();

}
/**
 * replace a keyword by its formal meaning.
 * @param {string} before - the keyword need to be replaced.
 * @param {string} after - the formal text represented by the keyword.
 */
function find_replace(before, after) {
    const selection = window.getSelection();

    selection.removeAllRanges();
    //save_undo();
    if (window.find) //for chrome, firefox
    {
        while (window.find(before)) {
            let last_letter;
            let range = window.getSelection().getRangeAt(0);
            if (window.getSelection().focusNode.length == window.getSelection().focusOffset) {
                last_letter = "";

            } else {
                range.setEnd(window.getSelection().focusNode, window.getSelection().focusOffset + 1);
                last_letter = range.toString().slice(-1);
            }

            if (window.getSelection().anchorOffset == 0) {
                const old_offset = window.getSelection().anchorOffset;
                console.log("no enough range");
                range.setStart(window.getSelection().anchorNode.previousSibling, window.getSelection().anchorNode.previousSibling.length - 1);
                first_letter = range.toString().slice(0, 1);
            } else {
                console.log("enough range" + window.getSelection().anchorOffset);
                range.setStart(window.getSelection().anchorNode, window.getSelection().anchorOffset - 1);
                first_letter = range.toString().slice(0, 1);
            }

            if (/[a-zA-Z\|\$]/.test(last_letter)) {
                console.log(range.toString(), "last letter " + last_letter);

            } else if (/[a-zA-Z\|\$]/.test(first_letter)) {
                console.log(range.toString(), "first letter " + first_letter);
            } else {
                console.log(range.toString(), "deleted with last letter: " + last_letter);
                range.deleteContents();
                range.insertNode(document.createTextNode(first_letter + after + last_letter));

            }

        }
    } else if (document.createTextRange) //for ie etc.
    {
        var range = document.createTextRange();
        while (range.findText(before)) {
            range.pasteHTML(after);
        }
    }

}



						

		</script>			
<body style="width:100%; height:auto; margin:0px; padding:0px "  >
  <div style="width:100%; height:auto;  padding:5px; margin-bottom:0px;
    border: 1px solid #EFEFEF;" id="interface" >
<nav>
  <div class="nav nav-tabs justify-content-center h6" id="nav-tab" role="tablist" >
    <button class="nav-link active" id="nav-project_name-tab" data-bs-toggle="tab" data-bs-target="#nav-project_name" type="button" role="tab" aria-controls="nav-project_name" aria-selected="true">1. Project name</button>
    <button class="nav-link" id="nav-data_type-tab" data-bs-toggle="tab" data-bs-target="#nav-data_type" type="button" role="tab" aria-controls="nav-data_type" aria-selected="false">2. Data type</button>
    <button class="nav-link" id="nav-data_volumn-tab" data-bs-toggle="tab" data-bs-target="#nav-data_volumn" type="button" role="tab" aria-controls="nav-data_volumn" aria-selected="false">3. Data volume</button>
	    <button class="nav-link" id="nav-relevant_standards-tab" data-bs-toggle="tab" data-bs-target="#nav-relevant_standards" type="button" role="tab" aria-controls="nav-relevant_standards" aria-selected="false">4. Relavent standards</button>
		    <button class="nav-link" id="nav-dataplant-tab" data-bs-toggle="tab" data-bs-target="#nav-dataplant" type="button" role="tab" aria-controls="nav-dataplant" aria-selected="false">5. Use DataPLANT?</button>
			    <button class="nav-link" id="nav-other_standards-tab" data-bs-toggle="tab" data-bs-target="#nav-other_standards" type="button" role="tab" aria-controls="nav-other_standards" aria-selected="false">6. Other standards</button>
				    <button class="nav-link" id="nav-eu-tab" data-bs-toggle="tab" data-bs-target="#nav-eu" type="button" role="tab" aria-controls="nav-eu" aria-selected="false">7. Europe project</button>
  </div>
</nav>
<div class="tab-content align-items-center h6" id="nav-tabContent" >
  <div class="tab-pane fade show active " id="nav-project_name" role="tabpanel" aria-labelledby="nav-project_name-tab">
  <p >1. Give the project name or acronym to be used:</p>
	<form >
		<label for="name is">The project name is:</label>
		<input type="text"
		       id="project_name"
		       name="$_PROJECT"
		       placeholder="give your project name here">
			<input type="button"
			       value="replace"
			       onclick="replace(this);">
				   <input type="button"
			       value="undo"
			       onclick="undo();">
  
	</form>
  
  
  </div>
 <div class="tab-pane fade  align-items-center" id="nav-data_type" role="tabpanel" aria-labelledby="nav-data_type-tab">
  <p>2. What kind of data do you handle:</p>
  <div class="form-data_type form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="1" id="check_image" >
  <label class="form-check-label" for="check_image">
    image
  </label>
</div> 
<div class="form-data_type form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="2" id="check_RNAseq" >
  <label class="form-check-label" for="check_RNAseq">
    RNAseq
  </label>
</div> 
<div class="form-data_type form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="3" id="check_genomic" >
  <label class="form-check-label" for="check_genomic">
    other NGS
  </label>
</div>  
  
<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="4" id="check_Metabolomic" >
  <label class="form-check-label" for="check_Metabolomic">
    Metabolomics
  </label>
</div> 


<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="5" id="check_Proteomic" >
  <label class="form-check-label" for="check_Proteomic">
    Proteomics
  </label>
</div> 

<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="6" id="check_targeted" >
  <label class="form-check-label" for="check_targeted">
    targeted assays (e.g. glucose and fructose content)
  </label>
</div> 
<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="7" id="check_models" >
  <label class="form-check-label" for="check_models">
    models
  </label>
</div> 
<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="8" id="check_code" >
  <label class="form-check-label" for="check_code">
    code
  </label>
</div> 
<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="9" id="check_excel" >
  <label class="form-check-label" for="check_excel">
    excel
  </label>
</div> 
<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_2nd" type="checkbox" value="10" id="check_cloned-DNA" >
  <label class="form-check-label" for="check_cloned-DNA">
    cloned DNA
  </label>
</div> 



<br>
<input type="button" id="check_box1"
			       value="submit data type"
			       onclick="check_box(this)" class="q_2nd"> 
				   <input type="button"
			       value="undo"
			       onclick="undo();">
  </div>
  <div class="tab-pane fade  align-items-center" id="nav-data_volumn" role="tabpanel" aria-labelledby="nav-data_volumn-tab">
  
  <p >3. How much data do you think you will generate:</p>
	<form >
		<label for="name is">raw data volume</label>
		<input type="text"
		       id="raw_data"
		       name="$_RAWDATA"
		       placeholder="give your raw data volume here">
			<input type="button"
			       value="replace"
			       onclick="replace(this);">
				   <input type="button"
			       value="undo"
			       onclick="undo();">
				   <br>
		<label for="name is">derived data volume</label>
		
		<input type="text"
		       id="derived_data"
		       name="$_DERIVEDDATA"
		       placeholder="give your derived data volume here">
			<input type="button"
			       value="replace"
			       onclick="replace(this);">
				   <input type="button"
			       value="undo"
			       onclick="undo();">
  
	</form>
  
  </div>
   
   
   <div class="tab-pane fade  align-items-center" id="nav-relevant_standards" role="tabpanel" aria-labelledby="nav-relevant_standards-tab">
    <p>4. are there any standards that are relevant for you?</p>
	<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_5th_b" type="checkbox" value="9" id="check_MIAPPE" >
  <label class="form-check-label" for="check_MIAPPE">
    MIAPPE
  </label>
</div> 
<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_5th_b" type="checkbox" value="10" id="check_MinSeqE" >
  <label class="form-check-label" for="check_MinSeqE">
    MinSeqE
  </label>
</div> 
	
	
	</div>
   
   
   
   
   <div class="tab-pane fade  align-items-center" id="nav-q5" role="tabpanel" aria-labelledby="nav-data_type-tab">

   
   
   
   </div>
    
	<div class="tab-pane fade  align-items-center" id="nav-dataplant" role="tabpanel" aria-labelledby="nav-dataplant-tab">
	<p>5. Are you going to use DataPLANT ARC</p>
	<div class="form-check form-switch form-check-inline">
	 <input class="form-check-input  q_5th_a" type="checkbox" id="check_dataplant" data-bs-toggle="collapse" data-bs-target="#q_5th_a" aria-expanded="false" aria-controls="q_5th_a" checked >
  <label class="form-check-label" for="check_dataplant">Yes I will use DataPLANT</label>
</div>
<input type="button" id="form-check-input"
			       value="submit data type"
			       onclick="check_box(this)" class="q_5th_a"> 
				   <input type="button"
			       value="undo"
			       onclick="undo();">
<div class="collapse" id="q_5th_a">

    <p>5.a Where will you submit your data as endpoints? (no #if in text)</p>
	
	ENA, GEO, NCBI, genbank, pride, proteomexchange, zenodo, dataDyrad
	<div class="form-data_type form-check-inline">
  <input class="form-check-input q_5th_b" type="checkbox" value="1" id="check_ena" >
  <label class="form-check-label" for="check_ena">
    ENA
  </label>
</div> 
<div class="form-data_type form-check-inline">
  <input class="form-check-input q_5th_b" type="checkbox" value="2" id="check_geo" checked>
  <label class="form-check-label" for="check_geo">
    GEO
  </label>
</div> 
<div class="form-data_type form-check-inline">
  <input class="form-check-input q_5th_b" type="checkbox" value="3" id="check_NCBI" checked>
  <label class="form-check-label" for="check_NCBI">
    NCBI
  </label>
</div>  
  
<div class="form-data_type  form-check-inline">
  <input class="form-check-input q_5th_b" type="checkbox" value="4" id="check_genbank" checked>
  <label class="form-check-label" for="check_genbank">
    genbank
  </label>
</div> 

</div>
	 </div>
	 
	 <div class="tab-pane fade  align-items-center" id="nav-other_standards" role="tabpanel" aria-labelledby="nav-other_standards-tab">
	 <p>6.1 Will you adhere to any high level metadata submission standards?</p>
<div class="form-data_type form-check-inline">
  <input class="form-check-input q_5th" type="checkbox" value="1" id="check_dublin_core" checked>
  <label class="form-check-label" for="check_dublin_core">
    Dublin Core
  </label>
</div> 
<div class="form-data_type form-check-inline">
  <input class="form-check-input q_5th" type="checkbox" value="2" id="check_marc_21" >
  <label class="form-check-label" for="check_marc_21">
    MARC 21
  </label>
</div> 	 
	 <p>6.2 When will you make your data public?</p> 

	<div class="form-check form-switch form-check-inline">
	 <input class="form-check-input  " type="checkbox" id="publish_early" data-bs-toggle="collapse" data-bs-target="#q6_2" aria-expanded="false" aria-controls="q6_2" checked >
  <label class="form-check-label" for="publish_early">Will you publish your data early?</label>
</div>

<div class="collapse" id="q6_2">

    <p>are there intellectual property (IP) issues to adhere to (e.g. patents you might want to file) or private partners involved whose IP has to be taken into account</p>
	

</div> 

</div>
	
	  <div class="tab-pane fade  align-items-center" id="nav-eu" role="tabpanel" aria-labelledby="nav-eu-tab">
	  <p>7. Is it a EU project?</p>

<div class="form-check form-switch form-check-inline">
	 <input class="form-check-input  q_7th_a" type="checkbox" id="check_eu" data-bs-toggle="collapse" data-bs-target="#q7_1" aria-expanded="false" aria-controls="q7_1" checked >
  <label class="form-check-label" for="check_eu">is it a EU project?</label>
</div>
<input type="button" id="form-check-input"
			       value="submit "
			       onclick="check_box(this)" class="q_7th_a"> 
				   <input type="button"
			       value="undo"
			       onclick="undo();">


	  </div>
	   </div>
</div>

	
	


	


	  
		
		</div>

    <div id="editorContainer"  style="width:100%; height:100vh; position: fixed;  padding:5px; ">
    </div>
	
	
	
	<script src="bootstrap.bundle.min.js" type="text/javascript" charset="utf-8"> </script>
    <script src="renderer.js"></script>
  </body>
</html>
